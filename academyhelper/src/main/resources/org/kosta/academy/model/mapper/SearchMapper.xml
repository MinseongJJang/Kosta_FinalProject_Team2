<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kosta.academy.model.mapper.SearchMapper">

<select id="getTotalCountByAddress" parameterType="string" resultType="int">
	select count(*) from  academy
	where upper (aca_addr) LIKE '%'||upper(#{value})||'%'
</select>

<resultMap type="curriculumVO" id="CRM1">
	<result property="academyVO.acaNo" column="aca_no" />	
	<result property="academyVO.acaName" column="aca_name" />
	<result property="academyVO.acaAddr" column="aca_addr" />
	<result property="academyVO.acaMainPic" column="aca_main_pic"/>
</resultMap> 
<select id="searchByAddress" parameterType="map" resultMap="CRM1">
	select a.aca_no, a.aca_name, a.aca_addr, a.aca_main_pic,c.cur_no, c.cur_name, c.cur_content,c.cur_main_pic
	from(select row_number() over(order by aca_no desc) as rnum, aca_no, cur_name, cur_no, cur_content,cur_main_pic from curriculum) c, academy a
	where upper (a.aca_addr) LIKE '%'||upper(#{ADDRESS})||'%' and a.aca_no = c.aca_no 
	and  rnum between #{STARTROWNUMBER} and #{ENDROWNUMBER} order by a.aca_no desc
</select>

<select id="getTotalCountByCurName" parameterType="string" resultType="int">
	select count(*) from  curriculum c, academy a
	where c.aca_no = a.aca_no and upper (cur_name) LIKE '%'||upper(#{value})||'%'
</select>

<select id="searchByCurName" parameterType="map" resultMap="CRM1">
	select a.aca_no, a.aca_name, a.aca_addr, a.aca_main_pic, c.cur_no, c.cur_name, c.cur_content, c.cur_main_pic
	from(select row_number() over(order by aca_no desc) as rnum, aca_no, cur_name, cur_no, cur_content, cur_main_pic from curriculum) c, academy a
	where upper (c.cur_name) LIKE '%'||upper(#{CURNAME})||'%' and a.aca_no = c.aca_no 
	and  rnum between ${STARTROWNUMBER}  and ${ENDROWNUMBER} order by a.aca_no desc
</select>

<select id="provinceList" resultType="locationVO">
	select distinct province from location
</select>

<select id="districtList" resultType="locationVO" parameterType="String">
	select district from location where province = #{province}
</select>
</mapper>